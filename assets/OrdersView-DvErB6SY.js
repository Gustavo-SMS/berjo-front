import{_ as B,u as P,a as z,b as L,r as d,s as Q,j as G,c as n,d as t,e,n as $,p as S,f as _,v as O,t as v,k as R,F as T,l as A,w as K,T as X,g as I,o as Y,q as V}from"./index-DQ8yE_dc.js";import{C as Z}from"./ConfirmationModal-jBfguLHW.js";import{_ as ee,a as te,b as oe}from"./SelectType-Ct7CqpyW.js";const ae={class:"order-row"},se={key:1},ne={key:1},le={key:1},ie={key:1},re={key:1},ue={key:1},de={key:1},ce=["disabled"],pe={class:"observation"},me={key:1},ve={__name:"OrderRow",props:["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","observation","status","blind_price","getOrders"],setup(y){const i=y,m=P(),k=z(),f=L(),g=d(!1),w="https://api-berjo.onrender.com",E=()=>{g.value=!0},c=d(!1),C=d(!0),N=()=>{c.value=!c.value,C.value=!C.value},D=d(i.quantity),b=d(i.type),U=d(i.collection),x=d(i.width),M=d(i.height),u=d(i.command_height),s=d(i.model),a=d(i.observation),o=d(i.blindTypeId),h=d(i.blind_price),j=(p,l)=>{b.value=l[p.target.selectedIndex]||null},q=(p,l)=>{o.value=l[p.target.selectedIndex].id||i.blindTypeId},F=Q(()=>({Vertical:["Lateral","Central","Invertida"],Horizontal:["Dir","Esq"],Rolo:["Dir","Esq","Duplex"],Romana:["Dir","Esq","Duplex"],"Double Vision":["Dir","Esq","Duplex"]})[b.value]||[]),W=async p=>{p.preventDefault();const l={id:i.id,quantity:D.value,type_id:o.value,width:x.value,height:M.value,command_height:u.value,model:s.value,observation:a.value};try{const r=await I(`${w}/blinds`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)},m,k);if(!r.ok){const J=await r.json();throw new Error(J.error||"Erro ao atualizar persiana")}f.addNotification("Persiana atualizada","success"),i.getOrders(i.status),N()}catch(r){console.error("Erro ao atualizar persiana: ",r.message),f.addNotification(r.message,"error")}},H=async()=>{try{const p=await I(`${w}/blinds/${i.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}},m,k);if(!p.ok){const l=await p.json();throw new Error(l.error||"Erro ao excluir persiana")}f.addNotification("Persiana excluida","success"),i.getOrders(i.status)}catch(p){console.error("Erro ao excluir persiana:",p.message),f.addNotification(p.message,"error")}};return G(()=>i.blind_price,p=>{h.value=p}),(p,l)=>(t(),n(T,null,[e("form",{onSubmit:K(W,["prevent"]),class:"order-row-wrapper"},[e("div",ae,[e("div",null,[c.value?_((t(),n("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=r=>D.value=r),id:"quantity",name:"quantity"},null,512)),[[O,D.value]]):(t(),n("p",se,v(y.quantity),1))]),e("div",null,[c.value?(t(),$(ee,{key:0,onSelectedOption:j,typeValue:b.value},null,8,["typeValue"])):(t(),n("p",ne,v(y.type),1))]),e("div",null,[c.value?(t(),$(te,{key:b.value,typeValue:b.value,collection:U.value,onSelectedOption:q},null,8,["typeValue","collection"])):(t(),n("p",le,v(y.collection+" "+y.color),1))]),e("div",null,[c.value?_((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=r=>x.value=r),id:"width",name:"width"},null,512)),[[O,x.value]]):(t(),n("p",ie,v(y.width),1))]),e("div",null,[c.value?_((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=r=>M.value=r),id:"height",name:"height"},null,512)),[[O,M.value]]):(t(),n("p",re,v(y.height),1))]),e("div",null,[c.value?_((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=r=>u.value=r),id:"command_height",name:"command_height"},null,512)),[[O,u.value]]):(t(),n("p",ue,v(y.command_height),1))]),e("div",null,[c.value?_((t(),n("select",{key:0,class:"form-control","onUpdate:modelValue":l[4]||(l[4]=r=>s.value=r)},[(t(!0),n(T,null,A(F.value,r=>(t(),n("option",{key:r},v(r),1))),128))],512)),[[R,s.value]]):(t(),n("p",de,v(y.model),1))]),e("div",null,[e("p",null,v(h.value),1)])]),i.status==="Em espera"?(t(),n(T,{key:0},[e("button",{onClick:N,type:"button",class:"btn btn-danger col-1"},"Editar"),e("button",{type:"submit",class:"btn btn-primary col-1",disabled:C.value},"Enviar",8,ce),e("button",{onClick:E,type:"button",class:"btn btn-warning col-1"},"Excluir")],64)):S("",!0),e("div",pe,[l[7]||(l[7]=e("label",{for:"observation"},"Observações: ",-1)),c.value?_((t(),n("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[5]||(l[5]=r=>a.value=r),id:"observation",name:"observation"},null,512)),[[O,a.value]]):(t(),n("p",me,v(y.observation),1))])],32),(t(),$(X,{to:"body"},[g.value?(t(),$(Z,{key:0,show:g.value,message:"Tem certeza que deseja excluir?",onConfirm:H,onClose:l[6]||(l[6]=r=>g.value=!1)},null,8,["show"])):S("",!0)]))],64))}},ye=B(ve,[["__scopeId","data-v-702e2899"]]),he={class:"container"},be={class:"filter-section"},fe={class:"order-header"},ge={class:"order-actions"},_e={key:0,class:"status-edit"},we=["onUpdate:modelValue"],ke=["onClick"],Ee=["onClick"],Ce={key:1,class:"status-view"},$e={class:"badge bg-secondary"},Se=["onClick"],Te={class:"fw-bold"},De=["onClick"],xe={__name:"OrdersView",setup(y){const i="https://api-berjo.onrender.com",m=P(),k=z(),f=L(),g=d("Em espera"),w=d([]),E=d(null),c=d({}),C=d(""),N=async()=>{await b(g.value,C.value)};function D(u,s){C.value=s[u.target.selectedIndex].id}const b=async(u,s)=>{let a=`${i}/orders/filter/`;m.userRole==="CUSTOMER"&&(s=m.customerId);const o=new URLSearchParams;u&&o.append("status",u),s&&o.append("customerId",s),o.toString()&&(a+=`?${o.toString()}`);try{const h=await I(a,{method:"GET",headers:{"Content-type":"application/json"},credentials:"include"},m,k);if(!h.ok){const q=await h.json();throw new Error(q.error||"Erro ao buscar pedidos")}const j=await h.json();w.value=j}catch(h){console.error(h.message),f.addNotification(h.message,"error")}};Y(()=>b("Em espera"));const U=(u,s)=>{E.value=u,c.value[u]=s},x=async u=>{const s=c.value[u];if(!s){alert("Selecione um status válido.");return}const a={id:u,status:s};try{const o=await I(`${i}/orders/status/`,{method:"PUT",headers:{"Content-type":"application/json"},credentials:"include",body:JSON.stringify(a)},m,k);if(!o.ok){const h=await o.json();throw new Error(h.error||"Erro ao mudar status")}await b(g.value||"Em espera"),E.value=null}catch(o){console.error(o.message),f.addNotification(o.message,"error")}},M=async u=>{if(confirm("Tem certeza que deseja excluir este pedido?"))try{const s=await I(`${i}/orders/${u}`,{method:"DELETE",headers:{"Content-type":"application/json"},credentials:"include"},m,k);if(!s.ok){const a=await s.json();throw new Error(a.error||"Erro ao excluir pedido")}f.addNotification("Pedido excluido","success"),w.value=w.value.filter(a=>a.id!==u)}catch(s){console.error(s.message),f.addNotification(s.message,"error")}};return(u,s)=>(t(),n("div",he,[e("div",be,[_(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>g.value=a),name:"selectStatus",id:"selectStatus",class:"form-select"},s[1]||(s[1]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluido",-1)]),512),[[R,g.value]]),V(m).userRole==="ADMIN"?(t(),$(oe,{key:0,onSelectedOption:D})):S("",!0),e("button",{onClick:N,class:"btn btn-outline-primary"},"Filtrar")]),(t(!0),n(T,null,A(w.value,a=>(t(),n("div",{key:a.id,class:"order-card"},[e("div",fe,[e("h5",null,"Cliente: "+v(a.customer.name),1),e("div",ge,[E.value===a.id?(t(),n("div",_e,[_(e("select",{"onUpdate:modelValue":o=>c.value[a.id]=o,class:"form-select"},s[2]||(s[2]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluído",-1)]),8,we),[[R,c.value[a.id]]]),E.value===a.id?(t(),n("button",{key:0,onClick:o=>x(a.id),class:"btn btn-success"},"Confirmar",8,ke)):(t(),n(T,{key:1},[V(m).userRole==="ADMIN"?(t(),n("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-primary"},"Mudar Status",8,Ee)):S("",!0)],64))])):(t(),n("div",Ce,[e("span",$e,v(a.status),1),V(m).userRole==="ADMIN"?(t(),n("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-outline-primary"}," Mudar Status ",8,Se)):S("",!0)])),e("span",Te,"Total: R$ "+v(a.total_price),1),V(m).userRole==="ADMIN"||V(m).userRole==="CUSTOMER"&&a.status==="Em espera"?(t(),n("button",{key:2,onClick:o=>M(a.id),class:"btn btn-outline-danger"},"Excluir",8,De)):S("",!0)])]),s[3]||(s[3]=e("div",{class:"order-table-header"},[e("span",null,"Qtd"),e("span",null,"Tipo"),e("span",null,"Cor"),e("span",null,"Largura"),e("span",null,"Altura"),e("span",null,"Alt. Cmd"),e("span",null,"Modelo"),e("span",null,"Preço")],-1)),(t(!0),n(T,null,A(a.blind,o=>(t(),$(ye,{key:o.id,id:o.id,quantity:o.quantity,type:o.type.type,collection:o.type.collection,blindTypeId:o.type.id,color:o.type.color,width:o.width,height:o.height,command_height:o.command_height,model:o.model,blind_price:o.blind_price,observation:o.observation,status:a.status,getOrders:b},null,8,["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","blind_price","observation","status"]))),128))]))),128))]))}},Ie=B(xe,[["__scopeId","data-v-f24692cf"]]);export{Ie as default};
