import{_ as B,u as P,a as z,b as L,r as u,s as Q,j as G,c as n,d as t,e,n as $,p as S,f as g,v as O,t as v,k as R,F as T,l as A,w as K,T as X,g as I,o as Y,q as V}from"./index-CS_e5Mk2.js";import{C as Z}from"./ConfirmationModal-B9iFZ6gS.js";import{_ as ee,a as te,b as oe}from"./SelectType-BuUrpODh.js";const ae={class:"order-row"},se={key:1},ne={class:"col-2"},le={key:1},ie={class:"col-2"},re={key:1},de={key:1},ue={key:1},ce={key:1},pe={key:1},me=["disabled"],ve={class:"observation"},ye={key:1},he={__name:"OrderRow",props:["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","observation","status","blind_price","getOrders"],setup(y){const i=y,m=P(),k=z(),f=L(),_=u(!1),w="https://api-berjo.onrender.com",E=()=>{_.value=!0},c=u(!1),C=u(!0),N=()=>{c.value=!c.value,C.value=!C.value},D=u(i.quantity),b=u(i.type),U=u(i.collection),x=u(i.width),M=u(i.height),d=u(i.command_height),s=u(i.model),a=u(i.observation),o=u(i.blindTypeId),h=u(i.blind_price),j=(p,l)=>{b.value=l[p.target.selectedIndex]||null},q=(p,l)=>{o.value=l[p.target.selectedIndex].id||i.blindTypeId},F=Q(()=>({Vertical:["Lateral","Central","Invertida"],Horizontal:["Dir","Esq"],Rolo:["Dir","Esq","Duplex"],Romana:["Dir","Esq","Duplex"],"Double Vision":["Dir","Esq","Duplex"]})[b.value]||[]),W=async p=>{p.preventDefault();const l={id:i.id,quantity:D.value,type_id:o.value,width:x.value,height:M.value,command_height:d.value,model:s.value,observation:a.value};try{const r=await I(`${w}/blinds`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)},m,k);if(!r.ok){const J=await r.json();throw new Error(J.error||"Erro ao atualizar persiana")}f.addNotification("Persiana atualizada","success"),i.getOrders(i.status),N()}catch(r){console.error("Erro ao atualizar persiana: ",r.message),f.addNotification(r.message,"error")}},H=async()=>{try{const p=await I(`${w}/blinds/${i.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}},m,k);if(!p.ok){const l=await p.json();throw new Error(l.error||"Erro ao excluir persiana")}f.addNotification("Persiana excluida","success"),i.getOrders(i.status)}catch(p){console.error("Erro ao excluir persiana:",p.message),f.addNotification(p.message,"error")}};return G(()=>i.blind_price,p=>{h.value=p}),(p,l)=>(t(),n(T,null,[e("form",{onSubmit:K(W,["prevent"]),class:"order-row-wrapper"},[e("div",ae,[e("div",null,[c.value?g((t(),n("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=r=>D.value=r),id:"quantity",name:"quantity"},null,512)),[[O,D.value]]):(t(),n("p",se,v(y.quantity),1))]),e("div",ne,[c.value?(t(),$(ee,{key:0,onSelectedOption:j,typeValue:b.value},null,8,["typeValue"])):(t(),n("p",le,v(y.type),1))]),e("div",ie,[c.value?(t(),$(te,{key:b.value,typeValue:b.value,collection:U.value,onSelectedOption:q},null,8,["typeValue","collection"])):(t(),n("p",re,v(y.collection+" "+y.color),1))]),e("div",null,[c.value?g((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=r=>x.value=r),id:"width",name:"width"},null,512)),[[O,x.value]]):(t(),n("p",de,v(y.width),1))]),e("div",null,[c.value?g((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=r=>M.value=r),id:"height",name:"height"},null,512)),[[O,M.value]]):(t(),n("p",ue,v(y.height),1))]),e("div",null,[c.value?g((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=r=>d.value=r),id:"command_height",name:"command_height"},null,512)),[[O,d.value]]):(t(),n("p",ce,v(y.command_height),1))]),e("div",null,[c.value?g((t(),n("select",{key:0,class:"form-control","onUpdate:modelValue":l[4]||(l[4]=r=>s.value=r)},[(t(!0),n(T,null,A(F.value,r=>(t(),n("option",{key:r},v(r),1))),128))],512)),[[R,s.value]]):(t(),n("p",pe,v(y.model),1))]),e("div",null,[e("p",null,v(h.value),1)])]),i.status==="Em espera"?(t(),n(T,{key:0},[e("button",{onClick:N,type:"button",class:"btn btn-danger col-1"},"Editar"),e("button",{type:"submit",class:"btn btn-primary col-1",disabled:C.value},"Enviar",8,me),e("button",{onClick:E,type:"button",class:"btn btn-warning col-1"},"Excluir")],64)):S("",!0),e("div",ve,[l[7]||(l[7]=e("label",{for:"observation"},"Observações: ",-1)),c.value?g((t(),n("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[5]||(l[5]=r=>a.value=r),id:"observation",name:"observation"},null,512)),[[O,a.value]]):(t(),n("p",ye,v(y.observation),1))])],32),(t(),$(X,{to:"body"},[_.value?(t(),$(Z,{key:0,show:_.value,message:"Tem certeza que deseja excluir?",onConfirm:H,onClose:l[6]||(l[6]=r=>_.value=!1)},null,8,["show"])):S("",!0)]))],64))}},be=B(he,[["__scopeId","data-v-a14edfa1"]]),fe={class:"container"},_e={class:"filter-section"},ge={class:"order-header"},we={class:"order-actions"},ke={key:0,class:"status-edit"},Ee=["onUpdate:modelValue"],Ce=["onClick"],$e=["onClick"],Se={key:1,class:"status-view"},Te={class:"badge bg-secondary"},De=["onClick"],xe={class:"fw-bold"},Me=["onClick"],Oe={__name:"OrdersView",setup(y){const i="https://api-berjo.onrender.com",m=P(),k=z(),f=L(),_=u("Em espera"),w=u([]),E=u(null),c=u({}),C=u(""),N=async()=>{await b(_.value,C.value)};function D(d,s){C.value=s[d.target.selectedIndex].id}const b=async(d,s)=>{let a=`${i}/orders/filter/`;m.userRole==="CUSTOMER"&&(s=m.customerId);const o=new URLSearchParams;d&&o.append("status",d),s&&o.append("customerId",s),o.toString()&&(a+=`?${o.toString()}`);try{const h=await I(a,{method:"GET",headers:{"Content-type":"application/json"},credentials:"include"},m,k);if(!h.ok){const q=await h.json();throw new Error(q.error||"Erro ao buscar pedidos")}const j=await h.json();w.value=j}catch(h){console.error(h.message),f.addNotification(h.message,"error")}};Y(()=>b("Em espera"));const U=(d,s)=>{E.value=d,c.value[d]=s},x=async d=>{const s=c.value[d];if(!s){alert("Selecione um status válido.");return}const a={id:d,status:s};try{const o=await I(`${i}/orders/status/`,{method:"PUT",headers:{"Content-type":"application/json"},credentials:"include",body:JSON.stringify(a)},m,k);if(!o.ok){const h=await o.json();throw new Error(h.error||"Erro ao mudar status")}await b(_.value||"Em espera"),E.value=null}catch(o){console.error(o.message),f.addNotification(o.message,"error")}},M=async d=>{if(confirm("Tem certeza que deseja excluir este pedido?"))try{const s=await I(`${i}/orders/${d}`,{method:"DELETE",headers:{"Content-type":"application/json"},credentials:"include"},m,k);if(!s.ok){const a=await s.json();throw new Error(a.error||"Erro ao excluir pedido")}f.addNotification("Pedido excluido","success"),w.value=w.value.filter(a=>a.id!==d)}catch(s){console.error(s.message),f.addNotification(s.message,"error")}};return(d,s)=>(t(),n("div",fe,[e("div",_e,[g(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>_.value=a),name:"selectStatus",id:"selectStatus",class:"form-select"},s[1]||(s[1]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluido",-1)]),512),[[R,_.value]]),V(m).userRole==="ADMIN"?(t(),$(oe,{key:0,onSelectedOption:D})):S("",!0),e("button",{onClick:N,class:"btn btn-outline-primary"},"Filtrar")]),(t(!0),n(T,null,A(w.value,a=>(t(),n("div",{key:a.id,class:"order-card"},[e("div",ge,[e("h5",null,"Cliente: "+v(a.customer.name),1),e("div",we,[E.value===a.id?(t(),n("div",ke,[g(e("select",{"onUpdate:modelValue":o=>c.value[a.id]=o,class:"form-select"},s[2]||(s[2]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluído",-1)]),8,Ee),[[R,c.value[a.id]]]),E.value===a.id?(t(),n("button",{key:0,onClick:o=>x(a.id),class:"btn btn-success"},"Confirmar",8,Ce)):(t(),n(T,{key:1},[V(m).userRole==="ADMIN"?(t(),n("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-primary"},"Mudar Status",8,$e)):S("",!0)],64))])):(t(),n("div",Se,[e("span",Te,v(a.status),1),V(m).userRole==="ADMIN"?(t(),n("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-outline-primary"}," Mudar Status ",8,De)):S("",!0)])),e("span",xe,"Total: R$ "+v(a.total_price),1),V(m).userRole==="ADMIN"||V(m).userRole==="CUSTOMER"&&a.status==="Em espera"?(t(),n("button",{key:2,onClick:o=>M(a.id),class:"btn btn-outline-danger"},"Excluir",8,Me)):S("",!0)])]),s[3]||(s[3]=e("div",{class:"order-table-header"},[e("span",null,"Qtd"),e("span",null,"Tipo"),e("span",null,"Cor"),e("span",null,"Largura"),e("span",null,"Altura"),e("span",null,"Alt. Cmd"),e("span",null,"Modelo"),e("span",null,"Preço")],-1)),(t(!0),n(T,null,A(a.blind,o=>(t(),$(be,{key:o.id,id:o.id,quantity:o.quantity,type:o.type.type,collection:o.type.collection,blindTypeId:o.type.id,color:o.type.color,width:o.width,height:o.height,command_height:o.command_height,model:o.model,blind_price:o.blind_price,observation:o.observation,status:a.status,getOrders:b},null,8,["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","blind_price","observation","status"]))),128))]))),128))]))}},Ue=B(Oe,[["__scopeId","data-v-f24692cf"]]);export{Ue as default};
