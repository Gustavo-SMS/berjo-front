import{u as b,a as g,b as y,r as c,o as _,c as S,d as E,e,w as k,f as x,v as N,g as P,_ as C,h as V,i as j}from"./index-CS_e5Mk2.js";const D={class:"modal-dialog"},A={class:"modal-content"},L={class:"modal-body"},$={class:"mb-3"},q={__name:"RecoverPasswordModal",setup(M,{expose:d}){const m=b(),l=g(),u=y(),f="https://api-berjo.onrender.com",t=c(""),h=async()=>{try{const a=await P(`${f}/users/recoverPassword`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.value})},m,l);if(!a.ok){const o=await a.json();throw new Error(o.error||o.msg||"Erro ao recuperar senha")}u.addNotification("Senha enviada com sucesso!","success"),v(),i()}catch(a){u.addNotification(a.message,"error")}},n=c(null);let r=null;_(()=>{n.value&&(r=new bootstrap.Modal(n.value))});const s=()=>{r&&r.show()},i=()=>{r&&r.hide()},v=()=>{t.value=""};return d({showModal:s}),(a,o)=>(E(),S("div",{class:"modal fade",ref_key:"recoverPasswordModal",ref:n,tabindex:"-1"},[e("div",D,[e("div",A,[e("form",{onSubmit:k(h,["prevent"])},[o[2]||(o[2]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Recuperar Senha"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",L,[e("div",$,[o[1]||(o[1]=e("label",{class:"form-label"},"Digite seu email",-1)),x(e("input",{type:"email",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=p=>t.value=p),required:""},null,512),[[N,t.value]])])]),o[3]||(o[3]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancelar"),e("button",{type:"submit",class:"btn btn-primary"},"Enviar")],-1))],32)])])],512))}},F={class:"login-container"},R={class:"login-actions"},T=["disabled"],U={__name:"LoginView",setup(M){const d="https://api-berjo.onrender.com",m=b(),l=y(),u=g(),f=c(null),t=c("");_(()=>{window.onCaptchaVerified=s=>{t.value=s},window.onCaptchaExpired=()=>{t.value=""},window.grecaptcha&&window.grecaptcha.ready(()=>{window.grecaptcha.render(document.querySelector(".g-recaptcha"),{sitekey:"6LecWiIrAAAAAOdnwqNgm9EyzsZsdLLZ_dU6P3g5",callback:"onCaptchaVerified","expired-callback":"onCaptchaExpired"})})});const h=async s=>{if(s.preventDefault(),!t.value){l.addNotification("Confirme o captcha para continuar.","error");return}const i=new FormData(f.value),v=Object.fromEntries(i);try{const a=await fetch(`${d}/login`,{method:"POST",headers:{"Content-type":"application/json"},credentials:"include",body:JSON.stringify(v)}),o=await a.json();if(!a.ok)throw a.status===403?new Error("Verificação do captcha falhou. Tente novamente."):new Error(o.error||o.msg||"Erro ao logar");const p=await fetch(`${d}/me`,{credentials:"include"}),w=await p.json();if(!p.ok)throw new Error(w.error||"Erro ao obter dados do usuário");m.setUser(w.role,w.customerId),u.push("/")}catch(a){console.log(a.message),l.addNotification(a.message,"error"),window.grecaptcha&&(window.grecaptcha.reset(),t.value="")}},n=c(null),r=()=>{var s;(s=n.value)==null||s.showModal()};return(s,i)=>(E(),S("main",F,[e("form",{ref_key:"loginForm",ref:f,onSubmit:k(h,["prevent"]),class:"login-form"},[i[0]||(i[0]=V('<h1 class="login-title" data-v-0e85f9f4>Faça Login</h1><div class="form-group" data-v-0e85f9f4><label for="login" data-v-0e85f9f4>Login</label><input id="login" name="login" type="text" class="form-input" placeholder="Digite o login" required data-v-0e85f9f4></div><div class="form-group" data-v-0e85f9f4><label for="password" data-v-0e85f9f4>Senha</label><input id="password" name="password" type="password" class="form-control" placeholder="Digite a senha" required data-v-0e85f9f4></div><div class="g-recaptcha" data-v-0e85f9f4></div>',4)),e("div",R,[e("button",{class:"btn-secondary",type:"button",onClick:r}," Esqueci minha senha "),j(q,{ref_key:"recoverPasswordModal",ref:n},null,512)]),e("button",{disabled:!t.value,type:"submit",class:"btn-primary full-width"}," Entrar ",8,T)],544)]))}},I=C(U,[["__scopeId","data-v-0e85f9f4"]]);export{I as default};
