import{_ as B,u as P,a as z,b as L,r as d,s as Q,j as G,c as n,d as t,e,n as $,p as x,f as g,v as O,t as v,k as R,F as S,l as A,w as K,T as X,g as I,o as Y,q as V}from"./index-DfWB3UVD.js";import{C as Z}from"./ConfirmationModal-Fssvqf8y.js";import{_ as ee,a as te,b as oe}from"./SelectType-DsfA-GJX.js";const ae={class:"col-1"},se={key:1},ne={class:"col-2"},le={key:1},ie={class:"col-2"},re={key:1},ce={class:"col-1"},de={key:1},ue={class:"col-1"},pe={key:1},me={class:"col-1"},ve={key:1},ye={class:"col-1"},he={key:1},be={class:"col-1"},fe=["disabled"],_e={class:"mt-2 col-12"},ge={key:1},we={__name:"OrderRow",props:["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","observation","status","blind_price","getOrders"],setup(y){const i=y,m=P(),k=z(),f=L(),_=d(!1),w="https://api-berjo.onrender.com",E=()=>{_.value=!0},u=d(!1),C=d(!0),N=()=>{u.value=!u.value,C.value=!C.value},T=d(i.quantity),b=d(i.type),U=d(i.collection),D=d(i.width),M=d(i.height),c=d(i.command_height),s=d(i.model),a=d(i.observation),o=d(i.blindTypeId),h=d(i.blind_price),j=(p,l)=>{b.value=l[p.target.selectedIndex]||null},q=(p,l)=>{o.value=l[p.target.selectedIndex].id||i.blindTypeId},F=Q(()=>({Vertical:["Lateral","Central","Invertida"],Horizontal:["Dir","Esq"],Rolo:["Dir","Esq","Duplex"],Romana:["Dir","Esq","Duplex"],"Double Vision":["Dir","Esq","Duplex"]})[b.value]||[]),W=async p=>{p.preventDefault();const l={id:i.id,quantity:T.value,type_id:o.value,width:D.value,height:M.value,command_height:c.value,model:s.value,observation:a.value};try{const r=await I(`${w}/blinds`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)},m,k);if(!r.ok){const J=await r.json();throw new Error(J.error||"Erro ao atualizar persiana")}f.addNotification("Persiana atualizada","success"),i.getOrders(i.status),N()}catch(r){console.error("Erro ao atualizar persiana: ",r.message),f.addNotification(r.message,"error")}},H=async()=>{try{const p=await I(`${w}/blinds/${i.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}},m,k);if(!p.ok){const l=await p.json();throw new Error(l.error||"Erro ao excluir persiana")}f.addNotification("Persiana excluida","success"),i.getOrders(i.status)}catch(p){console.error("Erro ao excluir persiana:",p.message),f.addNotification(p.message,"error")}};return G(()=>i.blind_price,p=>{h.value=p}),(p,l)=>(t(),n(S,null,[e("form",{onSubmit:K(W,["prevent"]),class:"row mb-2"},[e("div",ae,[u.value?g((t(),n("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=r=>T.value=r),id:"quantity",name:"quantity"},null,512)),[[O,T.value]]):(t(),n("p",se,v(y.quantity),1))]),e("div",ne,[u.value?(t(),$(ee,{key:0,onSelectedOption:j,typeValue:b.value},null,8,["typeValue"])):(t(),n("p",le,v(y.type),1))]),e("div",ie,[u.value?(t(),$(te,{key:b.value,typeValue:b.value,collection:U.value,onSelectedOption:q},null,8,["typeValue","collection"])):(t(),n("p",re,v(y.collection+" "+y.color),1))]),e("div",ce,[u.value?g((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=r=>D.value=r),id:"width",name:"width"},null,512)),[[O,D.value]]):(t(),n("p",de,v(y.width),1))]),e("div",ue,[u.value?g((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=r=>M.value=r),id:"height",name:"height"},null,512)),[[O,M.value]]):(t(),n("p",pe,v(y.height),1))]),e("div",me,[u.value?g((t(),n("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=r=>c.value=r),id:"command_height",name:"command_height"},null,512)),[[O,c.value]]):(t(),n("p",ve,v(y.command_height),1))]),e("div",ye,[u.value?g((t(),n("select",{key:0,class:"form-control","onUpdate:modelValue":l[4]||(l[4]=r=>s.value=r)},[(t(!0),n(S,null,A(F.value,r=>(t(),n("option",{key:r},v(r),1))),128))],512)),[[R,s.value]]):(t(),n("p",he,v(y.model),1))]),e("div",be,[e("p",null,v(h.value),1)]),i.status==="Em espera"?(t(),n(S,{key:0},[e("button",{onClick:N,type:"button",class:"btn btn-danger col-1"},"Editar"),e("button",{type:"submit",class:"btn btn-primary col-1",disabled:C.value},"Enviar",8,fe),e("button",{onClick:E,type:"button",class:"btn btn-warning col-1"},"Excluir")],64)):x("",!0),e("div",_e,[l[7]||(l[7]=e("label",{for:"observation"},"Observações: ",-1)),u.value?g((t(),n("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[5]||(l[5]=r=>a.value=r),id:"observation",name:"observation"},null,512)),[[O,a.value]]):(t(),n("p",ge,v(y.observation),1))])],32),(t(),$(X,{to:"body"},[_.value?(t(),$(Z,{key:0,show:_.value,message:"Tem certeza que deseja excluir?",onConfirm:H,onClose:l[6]||(l[6]=r=>_.value=!1)},null,8,["show"])):x("",!0)]))],64))}},ke=B(we,[["__scopeId","data-v-da70057b"]]),Ee={class:"container"},Ce={class:"filter-section d-flex flex-column flex-md-row gap-2 align-items-start align-items-md-center mb-4"},$e={class:"order-header"},xe={class:"d-flex flex-wrap gap-2 align-items-center"},Se={key:0,class:"d-flex gap-2 align-items-center"},Te=["onUpdate:modelValue"],De=["onClick"],Me=["onClick"],Oe={key:1,class:"d-flex gap-2 align-items-center"},Ve={class:"badge bg-secondary"},Ie=["onClick"],Ne={class:"fw-bold"},Ue=["onClick"],je={__name:"OrdersView",setup(y){const i="https://api-berjo.onrender.com",m=P(),k=z(),f=L(),_=d("Em espera"),w=d([]),E=d(null),u=d({}),C=d(""),N=async()=>{await b(_.value,C.value)};function T(c,s){C.value=s[c.target.selectedIndex].id}const b=async(c,s)=>{let a=`${i}/orders/filter/`;m.userRole==="CUSTOMER"&&(s=m.customerId);const o=new URLSearchParams;c&&o.append("status",c),s&&o.append("customerId",s),o.toString()&&(a+=`?${o.toString()}`);try{const h=await I(a,{method:"GET",headers:{"Content-type":"application/json"},credentials:"include"},m,k);if(!h.ok){const q=await h.json();throw new Error(q.error||"Erro ao buscar pedidos")}const j=await h.json();w.value=j}catch(h){console.error(h.message),f.addNotification(h.message,"error")}};Y(()=>b("Em espera"));const U=(c,s)=>{E.value=c,u.value[c]=s},D=async c=>{const s=u.value[c];if(!s){alert("Selecione um status válido.");return}const a={id:c,status:s};try{const o=await I(`${i}/orders/status/`,{method:"PUT",headers:{"Content-type":"application/json"},credentials:"include",body:JSON.stringify(a)},m,k);if(!o.ok){const h=await o.json();throw new Error(h.error||"Erro ao mudar status")}await b(_.value||"Em espera"),E.value=null}catch(o){console.error(o.message),f.addNotification(o.message,"error")}},M=async c=>{if(confirm("Tem certeza que deseja excluir este pedido?"))try{const s=await I(`${i}/orders/${c}`,{method:"DELETE",headers:{"Content-type":"application/json"},credentials:"include"},m,k);if(!s.ok){const a=await s.json();throw new Error(a.error||"Erro ao excluir pedido")}f.addNotification("Pedido excluido","success"),w.value=w.value.filter(a=>a.id!==c)}catch(s){console.error(s.message),f.addNotification(s.message,"error")}};return(c,s)=>(t(),n("div",Ee,[e("div",Ce,[g(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>_.value=a),name:"selectStatus",id:"selectStatus",class:"form-select w-100 w-md-auto"},s[1]||(s[1]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluido",-1)]),512),[[R,_.value]]),V(m).userRole==="ADMIN"?(t(),$(oe,{key:0,onSelectedOption:T})):x("",!0),e("button",{onClick:N,class:"btn btn-outline-primary"},"Filtrar")]),(t(!0),n(S,null,A(w.value,a=>(t(),n("div",{key:a.id,class:"order-card"},[e("div",$e,[e("h5",null,"Cliente: "+v(a.customer.name),1),e("div",xe,[E.value===a.id?(t(),n("div",Se,[g(e("select",{"onUpdate:modelValue":o=>u.value[a.id]=o,class:"form-select"},s[2]||(s[2]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluído",-1)]),8,Te),[[R,u.value[a.id]]]),E.value===a.id?(t(),n("button",{key:0,onClick:o=>D(a.id),class:"btn btn-success"},"Confirmar",8,De)):(t(),n(S,{key:1},[V(m).userRole==="ADMIN"?(t(),n("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-primary"},"Mudar Status",8,Me)):x("",!0)],64))])):(t(),n("div",Oe,[e("span",Ve,v(a.status),1),V(m).userRole==="ADMIN"?(t(),n("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-outline-primary"}," Mudar Status ",8,Ie)):x("",!0)])),e("span",Ne,"Total: R$ "+v(a.total_price),1),V(m).userRole==="ADMIN"||V(m).userRole==="CUSTOMER"&&a.status==="Em espera"?(t(),n("button",{key:2,onClick:o=>M(a.id),class:"btn btn-outline-danger"},"Excluir",8,Ue)):x("",!0)])]),s[3]||(s[3]=e("div",{class:"order-table-header"},[e("span",null,"Qtd"),e("span",null,"Tipo"),e("span",null,"Cor"),e("span",null,"Largura"),e("span",null,"Altura"),e("span",null,"Alt. Cmd"),e("span",null,"Modelo"),e("span",null,"Preço")],-1)),(t(!0),n(S,null,A(a.blind,o=>(t(),$(ke,{key:o.id,id:o.id,quantity:o.quantity,type:o.type.type,collection:o.type.collection,blindTypeId:o.type.id,color:o.type.color,width:o.width,height:o.height,command_height:o.command_height,model:o.model,blind_price:o.blind_price,observation:o.observation,status:a.status,getOrders:b},null,8,["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","blind_price","observation","status"]))),128))]))),128))]))}},Be=B(je,[["__scopeId","data-v-045518d0"]]);export{Be as default};
