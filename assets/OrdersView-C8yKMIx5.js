import{_ as P,u as z,a as L,b as F,r as d,s as Q,j as G,c as s,d as t,e,n as S,f as k,v as V,t as v,k as R,F as w,l as A,p as T,q as $,w as K,T as X,g as N,o as Y}from"./index-BV1mUEsg.js";import{C as Z}from"./ConfirmationModal-DAmnHIhG.js";import{_ as ee,a as te,b as oe}from"./SelectType-C6yozHiA.js";const ae={class:"order-row"},se={key:1},ne={key:1},le={key:1},ie={key:1},re={key:1},ue={key:1},de={key:1},ce={class:"order-actions"},pe={class:"observation"},me={key:1},ve={__name:"OrderRow",props:["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","observation","status","blind_price","getOrders"],setup(y){const i=y,m=z(),E=L(),f=F(),g=d(!1),_="https://api-berjo.onrender.com",C=()=>{g.value=!0},c=d(!1),D=d(!0),x=()=>{c.value=!c.value,D.value=!D.value},M=d(i.quantity),b=d(i.type),U=d(i.collection),O=d(i.width),I=d(i.height),u=d(i.command_height),n=d(i.model),a=d(i.observation),o=d(i.blindTypeId),h=d(i.blind_price),j=(p,l)=>{b.value=l[p.target.selectedIndex]||null},q=(p,l)=>{o.value=l[p.target.selectedIndex].id||i.blindTypeId},W=Q(()=>({Vertical:["Lateral","Central","Invertida"],Horizontal:["Dir","Esq"],Rolo:["Dir","Esq","Duplex"],Romana:["Dir","Esq","Duplex"],"Double Vision":["Dir","Esq","Duplex"]})[b.value]||[]),B=async p=>{p.preventDefault();const l={id:i.id,quantity:M.value,type_id:o.value,width:O.value,height:I.value,command_height:u.value,model:n.value,observation:a.value};try{const r=await N(`${_}/blinds`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)},m,E);if(!r.ok){const J=await r.json();throw new Error(J.error||"Erro ao atualizar persiana")}f.addNotification("Persiana atualizada","success"),i.getOrders(i.status),x()}catch(r){console.error("Erro ao atualizar persiana: ",r.message),f.addNotification(r.message,"error")}},H=async()=>{try{const p=await N(`${_}/blinds/${i.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}},m,E);if(!p.ok){const l=await p.json();throw new Error(l.error||"Erro ao excluir persiana")}f.addNotification("Persiana excluida","success"),i.getOrders(i.status)}catch(p){console.error("Erro ao excluir persiana:",p.message),f.addNotification(p.message,"error")}};return G(()=>i.blind_price,p=>{h.value=p}),(p,l)=>(t(),s(w,null,[e("form",{onSubmit:K(B,["prevent"]),class:"order-row-wrapper"},[e("div",ae,[e("div",null,[c.value?k((t(),s("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=r=>M.value=r),id:"quantity",name:"quantity"},null,512)),[[V,M.value]]):(t(),s("p",se,v(y.quantity),1))]),e("div",null,[c.value?(t(),S(ee,{key:0,onSelectedOption:j,typeValue:b.value},null,8,["typeValue"])):(t(),s("p",ne,v(y.type),1))]),e("div",null,[c.value?(t(),S(te,{key:b.value,typeValue:b.value,collection:U.value,onSelectedOption:q},null,8,["typeValue","collection"])):(t(),s("p",le,v(y.collection+" "+y.color),1))]),e("div",null,[c.value?k((t(),s("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=r=>O.value=r),id:"width",name:"width"},null,512)),[[V,O.value]]):(t(),s("p",ie,v(y.width),1))]),e("div",null,[c.value?k((t(),s("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=r=>I.value=r),id:"height",name:"height"},null,512)),[[V,I.value]]):(t(),s("p",re,v(y.height),1))]),e("div",null,[c.value?k((t(),s("input",{key:0,type:"number",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=r=>u.value=r),id:"command_height",name:"command_height"},null,512)),[[V,u.value]]):(t(),s("p",ue,v(y.command_height),1))]),e("div",null,[c.value?k((t(),s("select",{key:0,class:"form-control","onUpdate:modelValue":l[4]||(l[4]=r=>n.value=r)},[(t(!0),s(w,null,A(W.value,r=>(t(),s("option",{key:r},v(r),1))),128))],512)),[[R,n.value]]):(t(),s("p",de,v(y.model),1))]),e("div",null,[e("p",null,v(h.value),1)]),e("div",ce,[c.value?(t(),s(w,{key:0},[e("button",{type:"submit",onClick:B,class:"btn btn-success"},"Confirmar"),e("button",{type:"button",onClick:x,class:"btn btn-secondary"},"Cancelar")],64)):(t(),s(w,{key:1},[e("button",{onClick:x,type:"button",class:"btn btn-primary"},"Editar"),$(m).userRole==="ADMIN"?(t(),s("button",{key:0,onClick:C,type:"button",class:"btn btn-danger"},"Excluir")):T("",!0)],64))])]),e("div",pe,[l[7]||(l[7]=e("label",{for:"observation"},"Observações: ",-1)),c.value?k((t(),s("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":l[5]||(l[5]=r=>a.value=r),id:"observation",name:"observation"},null,512)),[[V,a.value]]):(t(),s("p",me,v(y.observation),1))])],32),(t(),S(X,{to:"body"},[g.value?(t(),S(Z,{key:0,show:g.value,message:"Tem certeza que deseja excluir?",onConfirm:H,onClose:l[6]||(l[6]=r=>g.value=!1)},null,8,["show"])):T("",!0)]))],64))}},ye=P(ve,[["__scopeId","data-v-ae5e73d7"]]),he={class:"container"},be={class:"filter-section"},fe={class:"order-header"},ge={class:"order-actions"},ke={key:0,class:"status-edit"},_e=["onUpdate:modelValue"],we=["onClick"],Ee=["onClick"],Ce={key:1,class:"status-view"},$e={class:"badge bg-secondary"},Se=["onClick"],Te={class:"fw-bold"},De=["onClick"],xe={__name:"OrdersView",setup(y){const i="https://api-berjo.onrender.com",m=z(),E=L(),f=F(),g=d("Em espera"),_=d([]),C=d(null),c=d({}),D=d(""),x=async()=>{await b(g.value,D.value)};function M(u,n){D.value=n[u.target.selectedIndex].id}const b=async(u,n)=>{let a=`${i}/orders/filter/`;m.userRole==="CUSTOMER"&&(n=m.customerId);const o=new URLSearchParams;u&&o.append("status",u),n&&o.append("customerId",n),o.toString()&&(a+=`?${o.toString()}`);try{const h=await N(a,{method:"GET",headers:{"Content-type":"application/json"},credentials:"include"},m,E);if(!h.ok){const q=await h.json();throw new Error(q.error||"Erro ao buscar pedidos")}const j=await h.json();_.value=j}catch(h){console.error(h.message),f.addNotification(h.message,"error")}};Y(()=>b("Em espera"));const U=(u,n)=>{C.value=u,c.value[u]=n},O=async u=>{const n=c.value[u];if(!n){alert("Selecione um status válido.");return}const a={id:u,status:n};try{const o=await N(`${i}/orders/status/`,{method:"PUT",headers:{"Content-type":"application/json"},credentials:"include",body:JSON.stringify(a)},m,E);if(!o.ok){const h=await o.json();throw new Error(h.error||"Erro ao mudar status")}await b(g.value||"Em espera"),C.value=null}catch(o){console.error(o.message),f.addNotification(o.message,"error")}},I=async u=>{if(confirm("Tem certeza que deseja excluir este pedido?"))try{const n=await N(`${i}/orders/${u}`,{method:"DELETE",headers:{"Content-type":"application/json"},credentials:"include"},m,E);if(!n.ok){const a=await n.json();throw new Error(a.error||"Erro ao excluir pedido")}f.addNotification("Pedido excluido","success"),_.value=_.value.filter(a=>a.id!==u)}catch(n){console.error(n.message),f.addNotification(n.message,"error")}};return(u,n)=>(t(),s("div",he,[e("div",be,[k(e("select",{"onUpdate:modelValue":n[0]||(n[0]=a=>g.value=a),name:"selectStatus",id:"selectStatus",class:"form-select"},n[1]||(n[1]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluido",-1)]),512),[[R,g.value]]),$(m).userRole==="ADMIN"?(t(),S(oe,{key:0,onSelectedOption:M})):T("",!0),e("button",{onClick:x,class:"btn btn-primary"},"Filtrar")]),(t(!0),s(w,null,A(_.value,a=>(t(),s("div",{key:a.id,class:"order-card"},[e("div",fe,[e("h5",null,"Cliente: "+v(a.customer.name),1),e("div",ge,[C.value===a.id?(t(),s("div",ke,[k(e("select",{"onUpdate:modelValue":o=>c.value[a.id]=o,class:"form-select"},n[2]||(n[2]=[e("option",{value:"Em espera"},"Em espera",-1),e("option",{value:"Em produção"},"Em produção",-1),e("option",{value:"Concluido"},"Concluído",-1)]),8,_e),[[R,c.value[a.id]]]),C.value===a.id?(t(),s("button",{key:0,onClick:o=>O(a.id),class:"btn btn-success"},"Confirmar",8,we)):(t(),s(w,{key:1},[$(m).userRole==="ADMIN"?(t(),s("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-primary"},"Mudar Status",8,Ee)):T("",!0)],64))])):(t(),s("div",Ce,[e("span",$e,v(a.status),1),$(m).userRole==="ADMIN"?(t(),s("button",{key:0,onClick:o=>U(a.id,a.status),class:"btn btn-outline-primary"}," Mudar Status ",8,Se)):T("",!0)])),e("span",Te,"Total: R$ "+v(a.total_price),1),$(m).userRole==="ADMIN"||$(m).userRole==="CUSTOMER"&&a.status==="Em espera"?(t(),s("button",{key:2,onClick:o=>I(a.id),class:"btn btn-outline-danger"},"Excluir",8,De)):T("",!0)])]),n[3]||(n[3]=e("div",{class:"order-table-header"},[e("span",null,"Qtd"),e("span",null,"Tipo"),e("span",null,"Cor"),e("span",null,"Largura"),e("span",null,"Altura"),e("span",null,"Alt. Cmd"),e("span",null,"Modelo"),e("span",null,"Preço"),e("span",null,"Ações")],-1)),(t(!0),s(w,null,A(a.blind,o=>(t(),S(ye,{key:o.id,id:o.id,quantity:o.quantity,type:o.type.type,collection:o.type.collection,blindTypeId:o.type.id,color:o.type.color,width:o.width,height:o.height,command_height:o.command_height,model:o.model,blind_price:o.blind_price,observation:o.observation,status:a.status,getOrders:b},null,8,["id","quantity","type","collection","blindTypeId","color","width","height","command_height","model","blind_price","observation","status"]))),128))]))),128))]))}},Ve=P(xe,[["__scopeId","data-v-07a447e6"]]);export{Ve as default};
